<div class="container-fluid animate__animated animate__fadeIn">
  <div class="card shadow-sm border-0 mb-4" style="background: linear-gradient(135deg, #198754, #20c997); color: white;">
    <div class="card-body p-4 d-flex justify-content-between align-items-center">
      <div>
        <h4 class="mb-1 fw-bold"><i class="fas fa-history me-2"></i>‡πÅ‡∏ü‡πâ‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h4>
        <p class="mb-0 opacity-75" id="history-header-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>
      <i class="fas fa-chalkboard-teacher fa-3x opacity-25"></i>
    </div>
  </div>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-3 d-flex flex-wrap gap-2 justify-content-between align-items-center">
      <div style="flex-grow: 1; min-width: 250px;">
        <input type="text" id="searchLessonHistory" class="form-control border-secondary" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤, ‡∏´‡πâ‡∏≠‡∏á, ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠..." onkeyup="filterLessonHistory()">
      </div>
      <button class="btn btn-danger fw-bold shadow-sm" onclick="analyzeProblems()">
        <i class="fas fa-stethoscope me-2"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
      </button>
    </div>
  </div>

  <div id="lessonHistoryContainer" class="row g-4">
    </div>
</div>

<div class="modal fade" id="editLessonHistoryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fw-bold"><i class="fas fa-edit me-2"></i>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body bg-light">
        <form id="editLessonHistoryForm">
          <input type="hidden" id="edit_dl_ts"> <div class="mb-3">
            <label class="form-label fw-bold">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
            <input type="text" class="form-control" id="edit_dl_topic">
          </div>

          <div class="card border-0 shadow-sm mb-3">
            <div class="card-header bg-white fw-bold text-primary">1. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
            <div class="card-body">
              <div class="mb-3"><label class="form-label fw-bold">1.1 ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label><textarea class="form-control" id="edit_dl_outcomes" rows="3"></textarea></div>
              <div class="row">
                <div class="col-md-6 mb-3"><label class="form-label fw-bold text-danger">1.2 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ</label><textarea class="form-control" id="edit_dl_problems" rows="3"></textarea></div>
                <div class="col-md-6 mb-3"><label class="form-label fw-bold text-success">1.3 ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label><textarea class="form-control" id="edit_dl_solutions" rows="3"></textarea></div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mb-3">
            <div class="card-header bg-white fw-bold text-info">2. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á (8 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î DPA)</div>
            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" id="edpa1"><label class="form-check-label" for="edpa1">1. ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏î‡∏¥‡∏°" id="edpa2"><label class="form-check-label" for="edpa2">2. ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏î‡∏¥‡∏°</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏≠‡∏á" id="edpa3"><label class="form-check-label" for="edpa3">3. ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏≠‡∏á</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à" id="edpa4"><label class="form-check-label" for="edpa4">4. ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞" id="edpa5"><label class="form-check-label" for="edpa5">5. ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="Feedback" id="edpa6"><label class="form-check-label" for="edpa6">6. ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Feedback ‡πÅ‡∏Å‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ" id="edpa7"><label class="form-check-label" for="edpa7">7. ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label></div></div>
                <div class="col-md-6"><div class="form-check"><input class="form-check-input edit-dpa-check" type="checkbox" value="‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ï‡∏ô‡πÄ‡∏≠‡∏á" id="edpa8"><label class="form-check-label" for="edpa8">8. ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mb-3">
            <div class="card-header bg-white fw-bold text-warning">3. ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ 3R8C ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô</div>
            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Reading" id="es1"><label class="form-check-label" for="es1">Reading (‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å)</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Writing" id="es2"><label class="form-check-label" for="es2">Writing (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ)</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Arithmetic" id="es3"><label class="form-check-label" for="es3">Arithmetic (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô)</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Critical Thinking" id="es4"><label class="form-check-label" for="es4">Critical Thinking</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Creativity" id="es5"><label class="form-check-label" for="es5">Creativity</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Cross-cultural" id="es6"><label class="form-check-label" for="es6">Cross-cultural</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Collaboration" id="es7"><label class="form-check-label" for="es7">Collaboration</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Communication" id="es8"><label class="form-check-label" for="es8">Communication</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Computing" id="es9"><label class="form-check-label" for="es9">Computing (ICT)</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Career Skills" id="es10"><label class="form-check-label" for="es10">Career Skills</label></div></div>
                <div class="col-md-4"><div class="form-check"><input class="form-check-input edit-skill-check" type="checkbox" value="Compassion" id="es11"><label class="form-check-label" for="es11">Compassion (‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°)</label></div></div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white fw-bold text-secondary">4. ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label fw-bold">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <textarea class="form-control" id="edit_dl_student_results" rows="2"></textarea>
              </div>
              <div class="alert alert-warning small">
                <i class="fas fa-info-circle me-1"></i> ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                  <input class="form-control" type="file" id="edit_dl_work_file" accept="image/*,application/pdf">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏û‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏® (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                  <input class="form-control" type="file" id="edit_dl_image_file" accept="image/*">
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="button" class="btn btn-warning fw-bold" id="btnSaveEditLesson" onclick="saveEditLessonHistory()">
          <i class="fas fa-save me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="problemAnalysisModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title fw-bold">
          <i class="fas fa-chart-pie me-2"></i>‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)
        </h5>
        <button type="button" class="btn-close btn-close-white shadow-none" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body bg-light" id="problemAnalysisBody">
        </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
      </div>
    </div>
  </div>
</div>