<div class="container-fluid py-4 animate__animated animate__fadeIn">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
    <div>
      <h4 class="fw-bold mb-1"><i class="fas fa-users-cog me-2 text-primary"></i>จัดการระบบผู้ใช้งาน</h4>
      <span class="text-muted small">เพิ่ม ลบ แก้ไข และจัดการสถานะนักเรียนแขวนลอย</span>
    </div>
    <div class="d-flex gap-2">
      <label class="btn btn-outline-info shadow-sm mb-0">
        <i class="fas fa-file-csv me-1"></i> นำเข้านักเรียน
        <input type="file" accept=".csv" class="d-none" onchange="handleFileUpload(this, 'student')">
      </label>
      <label class="btn btn-outline-success shadow-sm mb-0">
        <i class="fas fa-file-csv me-1"></i> นำเข้าครู
        <input type="file" accept=".csv" class="d-none" onchange="handleFileUpload(this, 'teacher')">
      </label>
      <button class="btn btn-primary shadow-sm" onclick="openModal('add')">
        <i class="fas fa-plus me-1"></i> เพิ่มผู้ใช้
      </button>
    </div>
  </div>

  <div id="uploadStatus" class="alert alert-info d-none shadow-sm"><i class="fas fa-spinner fa-spin me-2"></i> กำลังนำเข้าข้อมูล กรุณารอสักครู่...</div>

  <div class="card border-0 shadow-sm mb-4 rounded-3">
    <div class="card-body p-3">
      <div class="input-group">
        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
        <input type="text" id="searchInput" class="form-control border-start-0 ps-0" placeholder="ค้นหาด้วยรหัส, ชื่อ-สกุล หรือชั้นเรียน..." onkeyup="filterTable()">
      </div>
    </div>
  </div>

  <ul class="nav nav-tabs nav-fill mb-3 border-0" id="userTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active fw-bold fs-6 rounded-top border-0 pb-3" id="student-tab" data-bs-toggle="tab" data-bs-target="#student-pane" type="button" role="tab" style="color: #495057; background-color: transparent;">
        <i class="fas fa-user-graduate me-2 text-info"></i>ทะเบียนนักเรียน
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link fw-bold fs-6 rounded-top border-0 pb-3" id="staff-tab" data-bs-toggle="tab" data-bs-target="#staff-pane" type="button" role="tab" style="color: #495057; background-color: transparent;">
        <i class="fas fa-chalkboard-teacher me-2 text-success"></i>บุคลากร (ครู/แอดมิน)
      </button>
    </li>
  </ul>

  <div class="tab-content bg-white p-0 rounded-3 shadow-sm border" style="overflow: hidden;">
    
    <div class="tab-pane fade show active p-0" id="student-pane" role="tabpanel">
      <div class="tab-pane fade show active p-0" id="student-pane" role="tabpanel">
      
      <div id="studentSummaryContainer" class="bg-light border-bottom p-3" style="display: none;">
        <h6 class="fw-bold text-primary mb-2"><i class="fas fa-chart-pie me-2"></i>สรุปสถิตินักเรียน (จำแนกตามชั้นเรียน)</h6>
        
        <div class="row g-2 mb-3">
          <div class="col-md-3 col-6">
            <div class="card border-0 bg-white shadow-sm p-2 text-center h-100 rounded-3">
              <div class="text-muted" style="font-size: 0.75rem;">ทั้งหมด</div>
              <div class="fw-bold fs-5 text-dark" id="sumTotal">0</div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="card border-0 bg-success-subtle p-2 text-center h-100 rounded-3">
              <div class="text-success" style="font-size: 0.75rem;">สถานะปกติ</div>
              <div class="fw-bold fs-5 text-success" id="sumActive">0</div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="card border-0 bg-danger-subtle p-2 text-center h-100 rounded-3">
              <div class="text-danger" style="font-size: 0.75rem;">แขวนลอย</div>
              <div class="fw-bold fs-5 text-danger" id="sumSuspended">0</div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="card border-0 bg-info-subtle p-2 text-center h-100 rounded-3">
              <div class="text-info-emphasis" style="font-size: 0.75rem;">ชาย / หญิง</div>
              <div class="fw-bold fs-6 text-info-emphasis mt-1"><span id="sumMale">0</span> / <span id="sumFemale">0</span></div>
            </div>
          </div>
        </div>

        <div class="table-responsive bg-white rounded-3 shadow-sm border border-light">
          <table class="table table-sm table-bordered align-middle text-center mb-0" style="font-size: 0.85rem;">
            <thead class="table-light text-muted">
              <tr>
                <th rowspan="2" class="align-middle border-bottom-0">ชั้นเรียน</th>
                <th colspan="2">เพศ</th>
                <th colspan="2">สถานะ</th>
                <th rowspan="2" class="align-middle border-bottom-0 text-primary">รวมทั้งสิ้น</th>
              </tr>
              <tr>
                <th class="fw-normal">ชาย</th>
                <th class="fw-normal">หญิง</th>
                <th class="fw-normal text-success">ปกติ</th>
                <th class="fw-normal text-danger">แขวนลอย</th>
              </tr>
            </thead>
            <tbody id="summaryTableBody" class="text-dark">
              </tbody>
          </table>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-nowrap">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-nowrap">
          <thead class="table-light">
            <tr>
              <th class="ps-4">รหัสนักเรียน</th>
              <th>ชื่อ-สกุล</th>
              <th>ชั้นเรียน</th>
              <th class="text-center">สถานะ</th>
              <th class="text-end pe-4">จัดการ</th>
            </tr>
          </thead>
          <tbody id="tableBodyStudent">
            <tr><td colspan="5" class="text-center p-4">กำลังโหลดข้อมูล...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="tab-pane fade p-0" id="staff-pane" role="tabpanel">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-nowrap">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Username</th>
              <th>ชื่อ-สกุล</th>
              <th>กลุ่มงาน/วิชา</th>
              <th class="text-center">สิทธิ์การใช้งาน</th>
              <th class="text-end pe-4">จัดการ</th>
            </tr>
          </thead>
          <tbody id="tableBodyStaff">
            <tr><td colspan="5" class="text-center p-4">กำลังโหลดข้อมูล...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-primary text-white border-0">
        <h5 class="modal-title fw-bold" id="modalTitle"><i class="fas fa-user-edit me-2"></i>จัดการข้อมูลผู้ใช้งาน</h5>
        <button type="button" class="btn-close btn-close-white shadow-none" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4 bg-light">
        <form id="userForm">
          <input type="hidden" id="mode">
          
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small fw-bold text-muted">รหัส/Username</label>
              <input type="text" class="form-control" id="inputUser" placeholder="เช่น 12345 หรือ admin" required>
            </div>
            <div class="col-md-6">
              <label class="form-label small fw-bold text-muted">รหัสผ่าน</label>
              <input type="text" class="form-control" id="inputPass" required>
            </div>
            <div class="col-12">
              <label class="form-label small fw-bold text-muted">ชื่อ-สกุล</label>
              <input type="text" class="form-control" id="inputName" required>
            </div>
            
            <div class="col-md-6">
              <label class="form-label small fw-bold text-muted">สิทธิ์การใช้งาน (Role)</label>
              <select class="form-select" id="inputRole" onchange="toggleStatusField()">
                <option value="Student">นักเรียน (Student)</option>
                <option value="Teacher">ครูผู้สอน (Teacher)</option>
                <option value="Admin">ผู้ดูแลระบบ (Admin)</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label small fw-bold text-muted">ชั้นเรียน / กลุ่มงาน</label>
              <input type="text" class="form-control" id="inputDept" placeholder="เช่น ม.1/1 หรือ บริหาร">
            </div>

            <div class="col-12" id="statusFieldContainer">
              <label class="form-label small fw-bold text-danger"><i class="fas fa-info-circle me-1"></i>สถานะนักเรียน</label>
              <select class="form-select border-danger text-danger fw-bold" id="inputStatus">
                <option value="ปกติ" class="text-success">✅ ปกติ (มีตัวตนในห้องเรียน)</option>
                <option value="แขวนลอย" class="text-danger">❌ แขวนลอย (มีชื่อแต่ไม่เข้าเรียน)</option>
              </select>
            </div>

            <div class="col-12 d-none">
              <label class="form-label small fw-bold text-muted">Email (ทางเลือก)</label>
              <input type="email" class="form-control" id="inputEmail" value="-">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer border-0 bg-white">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
        <button type="button" class="btn btn-primary px-4" onclick="saveUser()"><i class="fas fa-save me-2"></i>บันทึกข้อมูล</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* แต่งเส้นใต้ Tab ให้ดู Modern */
  .nav-tabs .nav-link.active {
    border-bottom: 3px solid #0d6efd !important;
    color: #0d6efd !important;
  }
</style>